{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user (either landlord or tenant) in the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "role": {
          "type": "string",
          "description": "The user's role: 'landlord' or 'tenant'."
        },
        "firstName": {
          "type": "string",
          "description": "The user's first name."
        },
        "lastName": {
          "type": "string",
          "description": "The user's last name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "The user's phone number."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the user account was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "role",
        "firstName",
        "lastName",
        "email",
        "createdAt"
      ]
    },
    "Property": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Property",
      "type": "object",
      "description": "Represents a rental property.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the property entity."
        },
        "landlordId": {
          "type": "string",
          "description": "Reference to Landlord. (Relationship: Landlord 1:N Property)"
        },
        "name": {
          "type": "string",
          "description": "Name of the property."
        },
        "price": {
          "type": "number",
          "description": "Rental price of the property."
        },
        "location": {
          "type": "string",
          "description": "Location of the property (e.g., address)."
        },
        "images": {
          "type": "array",
          "description": "URLs of images for the property.",
          "items": {
            "type": "string"
          }
        },
        "amenities": {
          "type": "array",
          "description": "List of amenities offered by the property.",
          "items": {
            "type": "string"
          }
        },
        "availabilityStatus": {
          "type": "string",
          "description": "Current availability status of the property (e.g., 'available', 'occupied')."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the property."
        }
      },
      "required": [
        "id",
        "landlordId",
        "name",
        "price",
        "location",
        "availabilityStatus"
      ]
    },
    "ViewingRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ViewingRequest",
      "type": "object",
      "description": "Represents a viewing request submitted by a user for a property.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the viewing request entity."
        },
        "propertyId": {
          "type": "string",
          "description": "Reference to Property. (Relationship: Property 1:N ViewingRequest)"
        },
        "landlordId": {
          "type": "string",
          "description": "Reference to Landlord. (Relationship: Landlord 1:N ViewingRequest)"
        },
        "name": {
          "type": "string",
          "description": "Name of the person requesting the viewing."
        },
        "email": {
          "type": "string",
          "description": "Email of the person requesting the viewing.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the person requesting the viewing."
        },
        "preferredTime": {
          "type": "string",
          "description": "Preferred time for the viewing."
        },
        "status": {
          "type": "string",
          "description": "Status of the viewing request (e.g., 'pending', 'approved', 'rejected')."
        },
        "requestDate": {
          "type": "string",
          "description": "Date when the viewing request was submitted.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "propertyId",
        "landlordId",
        "name",
        "preferredTime"
      ]
    },
    "RentalApplication": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RentalApplication",
      "type": "object",
      "description": "Represents a rental application submitted by a tenant for a property.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the rental application entity."
        },
        "propertyId": {
          "type": "string",
          "description": "Reference to Property. (Relationship: Property 1:N RentalApplication)"
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant. (Relationship: Tenant 1:N RentalApplication)"
        },
        "applicationDate": {
          "type": "string",
          "description": "Date when the application was submitted.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Status of the application (e.g., 'pending', 'approved', 'rejected')."
        },
        "notes": {
          "type": "string",
          "description": "Any notes added with the rental application"
        }
      },
      "required": [
        "id",
        "propertyId",
        "tenantId",
        "applicationDate",
        "status"
      ]
    },
    "Lease": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Lease",
      "type": "object",
      "description": "Represents a lease agreement between a landlord and a tenant for a property.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the lease entity."
        },
        "propertyId": {
          "type": "string",
          "description": "Reference to Property. (Relationship: Property 1:1 Lease)"
        },
        "landlordId": {
          "type": "string",
          "description": "Reference to Landlord. (Relationship: Landlord 1:N Lease)"
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant. (Relationship: Tenant 1:1 Lease)"
        },
        "startDate": {
          "type": "string",
          "description": "Start date of the lease.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "End date of the lease.",
          "format": "date-time"
        },
        "rentAmount": {
          "type": "number",
          "description": "Monthly rent amount."
        },
        "paymentDueDate": {
          "type": "number",
          "description": "Day of the month when rent is due."
        },
        "leaseDocumentUrl": {
          "type": "string",
          "description": "A URL pointing to the signed lease"
        }
      },
      "required": [
        "id",
        "propertyId",
        "landlordId",
        "tenantId",
        "startDate",
        "endDate",
        "rentAmount",
        "paymentDueDate"
      ]
    },
    "Payment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Payment",
      "type": "object",
      "description": "Represents a rent payment made by a tenant for a lease.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the payment entity."
        },
        "leaseId": {
          "type": "string",
          "description": "Reference to Lease. (Relationship: Lease 1:N Payment)"
        },
        "paymentDate": {
          "type": "string",
          "description": "Date when the payment was made.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "Amount paid."
        },
        "paymentMethod": {
          "type": "string",
          "description": "Payment method used (e.g., 'Mpesa', 'Stripe', 'PayPal')."
        },
        "confirmationNumber": {
          "type": "string",
          "description": "Confirmation number or transaction ID from the payment gateway."
        },
        "status": {
          "type": "string",
          "description": "Status of the payment (e.g., 'paid', 'pending', 'failed')."
        }
      },
      "required": [
        "id",
        "leaseId",
        "paymentDate",
        "amount",
        "paymentMethod",
        "status"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles (landlords and tenants).",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/properties/{propertyId}",
        "definition": {
          "entityName": "Property",
          "schema": {
            "$ref": "#/backend/entities/Property"
          },
          "description": "Stores property information. Includes denormalized 'landlordId' for authorization independence.",
          "params": [
            {
              "name": "propertyId",
              "description": "The unique identifier for the property."
            }
          ]
        }
      },
      {
        "path": "/properties/{propertyId}/viewingRequests/{viewingRequestId}",
        "definition": {
          "entityName": "ViewingRequest",
          "schema": {
            "$ref": "#/backend/entities/ViewingRequest"
          },
          "description": "Stores viewing requests for a property. Includes denormalized 'landlordId' for authorization independence.",
          "params": [
            {
              "name": "propertyId",
              "description": "The unique identifier for the property."
            },
            {
              "name": "viewingRequestId",
              "description": "The unique identifier for the viewing request."
            }
          ]
        }
      },
      {
        "path": "/rentalApplications/{rentalApplicationId}",
        "definition": {
          "entityName": "RentalApplication",
          "schema": {
            "$ref": "#/backend/entities/RentalApplication"
          },
          "description": "Stores rental applications submitted by tenants. Includes denormalized 'propertyId' and 'tenantId' for filtering properties.",
          "params": [
            {
              "name": "rentalApplicationId",
              "description": "The unique identifier for the rental application."
            }
          ]
        }
      },
      {
        "path": "/leases/{leaseId}",
        "definition": {
          "entityName": "Lease",
          "schema": {
            "$ref": "#/backend/entities/Lease"
          },
          "description": "Stores lease agreements. Includes denormalized 'landlordId' and 'tenantId' for filtering properties and authorization independence.",
          "params": [
            {
              "name": "leaseId",
              "description": "The unique identifier for the lease."
            }
          ]
        }
      },
      {
        "path": "/payments/{paymentId}",
        "definition": {
          "entityName": "Payment",
          "schema": {
            "$ref": "#/backend/entities/Payment"
          },
          "description": "Stores rent payments.  Denormalizes `leaseId` for authorization purposes.",
          "params": [
            {
              "name": "paymentId",
              "description": "The unique identifier for the payment."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support a multi-landlord, multi-tenant real estate and rental management platform. It prioritizes authorization independence and simplifies security rules by denormalizing authorization data. The design adheres to the principle of Structural Segregation to guarantee a homogeneous security posture within collections.\n\n**Authorization Independence:**\n\n*   Authorization independence is achieved by denormalizing authorization-related data. For instance, properties are stored under `/properties/{propertyId}`, and they include the `landlordId`.  This allows rules to check if `request.auth.uid == resource.data.landlordId` without needing to perform a `get()` operation on a parent document.\n\n**QAPs (Rules are not Filters):**\n\n*   Secure list operations (QAPs) are supported by Structural Segregation and Access Modeling. For example:\n\n    *   Landlords can only list properties that they own by querying `/properties` with a `WHERE landlordId == request.auth.uid` clause. Security Rules ensure they can only access documents where the `landlordId` matches their `uid`.\n    *   Tenants can browse all available rentals in the `/properties` collection.\n\n**Role-Based Access Control:**\n\n*   The `users/{userId}` collection stores the user's role (`landlord` or `tenant`). This role is used to determine access to specific features and data.  Since access to `properties` and `viewingRequests` relies on the landlordId, and `RentalApplication` relies on the `tenantId`, the rules can easily validate the user's access based on their `uid`.\n\n**Other Considerations:**\n\n*   Timestamps (`createdAt`, `applicationDate`, `paymentDate`, `startDate`, `endDate`, `requestDate`) are included for audit trails and chronological ordering.\n*   String `status` fields (`availabilityStatus`, `status`) are used instead of booleans to represent state explicitly and prevent implicit state modeling.\n\nThe structure enables simple, robust, and easily debuggable security rules, facilitating a scalable platform for real estate and rental management."
  }
}